# 課題 (ルータの CLI を作ろう) レポート

##課題内容

ルータのコマンドラインインタフェース (CLI) を作ろう。

次の操作ができるコマンドを作ろう。

* ルーティングテーブルの表示
* ルーティングテーブルエントリの追加と削除
* ルータのインタフェース一覧の表示
* そのほか、あると便利な機能

コントローラを操作するコマンドの作りかたは、第3回パッチパネルで作った patch_panel コマンドを参考にしてください。

##方針

bin ディレクトリ内にsimple_router ファイルを作成、その中にルーターに対して種々の操作を実行するコマンドのコードを記述した。これらのコマンドは、第3回パッチパネルで作成した patch_panel コマンドと同じ仕組みでターミナルから実行されて動作する。以下にそれらのコマンドの名前と操作内容を列挙する。

<dl>
	<dt>route [dpid] </dt>
	<dd>dpid の ID を持つルーターのルーティングテーブルを表示する。</dd> 
	<dt>route_add [dpid] [destination] [netmask_length] [next_hop]</dt>
	<dd>dpid の ID を持つルーターのルーティングテーブルにエントリを追加する。そのエントリでは、宛先アドレスに destination 、サブネットマスクに netmask_length 、次のホップ先アドレスに next_hop を指定する。</dd>
	<dt>route_delete [dpid] [destination]</dt>
	<dd>dpid の ID を持つルーターのルーティングテーブルから、宛先アドレスが destination であるエントリを削除する。</dd>
	<dt>show_interface [dpid]</dt>
	<dd>dpid の ID を持つルーターのインターフェイスの一覧を表示する。</dd> 
</dl>

続いて、各コマンドについてその動作の概要と実装について説明する。

##route コマンド
ルーターはこのコマンドを受け取ると自身のルーティングテーブルを参照し、サブネットマスクの大きいエントリから順に一行ずつ出力する。ここで、route コマンドは /lib/simple_router.rb の show_table メソッド（新たに作成したメソッド）を呼び出している。show_table メソッドでは、ルーティングテーブル (table) をサブネットマスク毎に参照 (tabel[each_mask]) して to_a メソッドで配列に変換して table_array に格納し、要素 (= エントリ) 毎にターミナルに出力している。

##route_add コマンド 
route_add コマンドは、 /lib/simple_router.rb の add_entry メソッド（新たに作成したメソッド）を呼び出している。ここでは新しいエントリとしてハッシュを作成している (entry に格納)。これは、ルーティングテーブルの実装を記述している /lib/routing_table.rb において、エントリを追加する add メソッドの引数にハッシュが指定されていることに準拠している。このハッシュの各キーにコマンドで指定した値を代入し、前述の add メソッドを呼び出すことで、エントリの追加を実現している。

##route_delete コマンド
route_delete コマンドは、 /lib/simple_router.rb の delete_entry メソッド（新たに作成したメソッド）を呼び出している。このメソッドは /lib/routing_table.rb の delete メソッドを呼び出して、エントリの削除をルーティングテーブルに移譲する。そして当該エントリが存在したかの真偽を delete メソッドから受け取り、結果に応じてメッセージをターミナルに出力する。delete メソッドでは、各サブネットマスクのテーブル (ハッシュで実装されている) に対して、コマンドの引数で受け取った宛先アドレスをキーに指定して、 Hash.delete メソッドでエントリの削除を試みている。

##show_interface コマンド
show_interface コマンドは、 /lib/simple_router.rb の show_interface メソッド（新たに作成したメソッド）を呼び出している。ルーターのインターフェイスは、 /lib/interface.rb で実装されていて、ルータは起動時に simple_router.conf に記述されたインターフェイス情報を読み込んで、ここに格納する。show_interface メソッドは、これら各インターフェイスの情報に逐次アクセスし、ターミナルに表示している。


















